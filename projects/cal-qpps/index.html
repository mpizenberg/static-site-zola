<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>@Piz - Projects - Calibrated quasi-planar photometric stereo</title>
		<link rel="stylesheet" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/main.css">
		<link rel="stylesheet" href="//cdn.materialdesignicons.com/4.4.95/css/materialdesignicons.min.css">
	</head>

	<body>
		
	

<nav class="navbar is-primary has-text-weight-bold is-size-5" role="navigation" aria-label="main navigation">
	<div class="navbar-brand">
		<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/about-me/">@Piz</a>
	</div>
	<div class="navbar-menu is-active">
		<div class="navbar-start">
		</div>
		<div class="navbar-end">
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/videos&#x2F;">Videos</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/posts&#x2F;">Posts</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/projects&#x2F;">Projects</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/research&#x2F;">Research</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/hire-me&#x2F;">Hire me</a>
			
		</div>
	</div>
</nav>

		



<section class="section">
<div class="container">
<div class="columns is-centered">
<div class="column is-7-widescreen is-8-desktop is-10-tablet">
<h1 class="title is-4">Calibrated quasi-planar photometric stereo</h1>

<p class="subtitle is-5">
<em>Matthieu Pizenberg, Florian Vincent, Yvain Qu√©au</em><br>
Rust implementation of a calibrated quasi-planar photometric stereo algorithm, with a CLI and a Web app<br>
2022<br>
</p>

<p>
<span class="tag"><a href="https:&#x2F;&#x2F;github.com&#x2F;mpizenberg&#x2F;calibrated-quasi-planar-photometric-stereo">Code</a></span>

<span class="tag"><a href="https:&#x2F;&#x2F;youtu.be&#x2F;oGjEF13Qmvs">Video</a></span>

<span class="tag"><a href="https:&#x2F;&#x2F;mpizenberg.github.io&#x2F;resources&#x2F;calibrated-quasi-planar-photometric-stereo&#x2F;photometric-stereo-web-rust-cv-sept-2021.pdf">Slides</a></span>
</p>

<div class="research-content content"><p><a href="https://youtu.be/oGjEF13Qmvs"><img src="https://img.youtube.com/vi/oGjEF13Qmvs/0.jpg" alt="Watch the video" /></a></p>
<p>Slides of the video above: <a href="https://mpizenberg.github.io/resources/calibrated-quasi-planar-photometric-stereo/photometric-stereo-web-rust-cv-sept-2021.pdf">pdf</a></p>
<p>This is a Rust implementation of a calibrated quasi-planar photometric stereo algorithm.
This repository is organized in four main directories:</p>
<ul>
<li><code>cal-qp-ps-lib/</code>: the core parts of the algorithm presented as a Rust library.</li>
<li><code>cal-qp-ps-bin/</code>: an example CLI executable program.</li>
<li><code>cal-qp-ps-wasm/</code>: the WebAssembly modules exposing the algorithm in wasm.</li>
<li><code>web-elm/</code>: the frontend application, made in Elm.</li>
</ul>
<h2 id="example-cli-application">Example CLI application</h2>
<p>To run the example CLI application, simply move into the <code>cal-...-bin/</code> directory
and run a command similar to this one:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">cargo</span><span> run</span><span style="color:#bf616a;"> --release</span><span> -- --lights data-bayeux/lights.csv data-bayeux/*.jpg
</span></code></pre>
<p>Where <code>lights.csv</code> contains the directions of the lights for each image.
It is obtained from the light calibration step and looks like as follows:</p>
<pre data-lang="csv" style="background-color:#2b303b;color:#c0c5ce;" class="language-csv "><code class="language-csv" data-lang="csv"><span style="color:#d08770;">-5572.41288647651</span><span>,</span><span style="color:#d08770;">10223.2280248599</span><span>,</span><span style="color:#d08770;">15623.3881625612
</span><span style="color:#d08770;">876.927634237602</span><span>,</span><span style="color:#d08770;">11292.6574672864</span><span>,</span><span style="color:#d08770;">17249.6879948994
</span><span style="color:#d08770;">12776.0813287204</span><span>,</span><span style="color:#d08770;">8668.26040675236</span><span>,</span><span style="color:#d08770;">13911.4380411348
</span><span style="color:#d08770;">...
</span></code></pre>
<p>The images passed as arguments with <code>data-bayeux/*jpg</code> should not contain
the first, almost black, reference image.
We do as if it was already deducted from all images.</p>
<h2 id="web-application">Web application</h2>
<p>To build and run the Web application for this photometric stereo algorithm,
perform the following steps:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#65737e;"># move into the wasm directory
</span><span style="color:#96b5b4;">cd</span><span> cal-qp-ps-wasm/
</span><span>
</span><span style="color:#65737e;"># build the rust code into a wasm module
</span><span style="color:#bf616a;">wasm-pack</span><span> build</span><span style="color:#bf616a;"> --target</span><span> web -- --features console_error_panic_hook
</span><span>
</span><span style="color:#65737e;"># move into the web app directory
</span><span style="color:#96b5b4;">cd</span><span> ../web-elm/
</span><span>
</span><span style="color:#65737e;"># build the frontend app
</span><span style="color:#bf616a;">elm</span><span> make src/Main.elm</span><span style="color:#bf616a;"> --optimize --output</span><span>=static/Elm.js
</span><span>
</span><span style="color:#65737e;"># move into the statically served directory
</span><span style="color:#96b5b4;">cd</span><span> static/
</span><span>
</span><span style="color:#65737e;"># turn the JS modules into simple JS files
</span><span style="color:#65737e;"># ps: --watch is rather convenient here
</span><span style="color:#bf616a;">esbuild</span><span> worker.mjs</span><span style="color:#bf616a;"> --bundle --preserve-symlinks --outfile</span><span>=worker.js
</span><span>
</span><span style="color:#65737e;"># start a static server able to serve wasm files
</span><span style="color:#65737e;"># with the correct mime types such as http-server
</span><span style="color:#bf616a;">http-server
</span><span>
</span><span style="color:#65737e;"># open http://localhost:8080 in your Web browser of choice
</span></code></pre>
</div>

</div>
</div>
</div>
</section>


	</body>
</html>
