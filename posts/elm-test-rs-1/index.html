<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>@Piz - Posts - Announcing elm-test-rs 1.0.0</title>
		<link rel="stylesheet" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/main.css">
		<link rel="stylesheet" href="//cdn.materialdesignicons.com/4.4.95/css/materialdesignicons.min.css">
	</head>

	<body>
		
	

<nav class="navbar is-primary has-text-weight-bold is-size-5" role="navigation" aria-label="main navigation">
	<div class="navbar-brand">
		<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/about-me/">@Piz</a>
	</div>
	<div class="navbar-menu is-active">
		<div class="navbar-start">
		</div>
		<div class="navbar-end">
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/videos&#x2F;">Videos</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/posts&#x2F;">Posts</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/projects&#x2F;">Projects</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/research&#x2F;">Research</a>
			
			
				
			
			<a class="navbar-item" href="https:&#x2F;&#x2F;matthieu.pizenberg.fr/hire-me&#x2F;">Hire me</a>
			
		</div>
	</div>
</nav>

		



<section class="section">
<div class="container">
<div class="columns is-centered">
<div class="column is-7-widescreen is-8-desktop is-10-tablet">
<h1 class="title is-4">Announcing elm-test-rs 1.0.0</h1>

<p class="subtitle is-5">
2021-03-01<br>
</p>

<div class="content"><p>I am pleased to announce the release of <a href="https://github.com/mpizenberg/elm-test-rs/releases">version 1.0.0</a> of <a href="https://github.com/mpizenberg/elm-test-rs">elm-test-rs</a>, a fast and portable executable to run your Elm tests! A special thanks to <a href="https://discourse.elm-lang.org/u/harrysarson">@harrysarson</a> as well as to all other people who contributed their time to this project!</p>
<span id="continue-reading"></span><h2 id="installation">Installation</h2>
<p>You can install elm-test-rs <strong>globally</strong> simply by <a href="https://github.com/mpizenberg/elm-test-rs/releases">downloading the latest executable</a> for your system and placing it in one of the directories in your <code>PATH</code> environment variable.</p>
<p>You can also install elm-test-rs <strong>locally</strong> for a project by adding it to your <a href="https://elm-tooling.github.io/elm-tooling-cli/spec/#tools"><code>elm-tooling.json</code></a> config file and running <code>elm-tooling install</code>.</p>
<p>You can install elm-test-rs <strong>in your CI</strong>, as well as elm and other tools with <a href="https://github.com/mpizenberg/elm-tooling-action">this GitHub action</a>.</p>
<h2 id="new-features">New features</h2>
<p>Elm-test-rs has quite a few new features compared to elm-test. The two most interesting in my opinion are:</p>
<ol>
<li>Capturing calls to <code>Debug.log</code> and reporting them in failure reports.</li>
<li>Being able to test your code with the lowest version bounds of your package dependencies to make sure they are correct.</li>
</ol>
<p>(2) will make most sense to package authors and (1) was one of the most requested feature for elm-test. Here is an example output reporting in a failing test a call to <code>Debug.log &quot;The question was&quot; question</code>.</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>Running 1 tests. To reproduce these results later,
</span><span>run elm-test-rs with --seed 2433154680 and --fuzz 100
</span><span>
</span><span>↓ Question
</span><span>✗ answer
</span><span>
</span><span>    43
</span><span>    ╷
</span><span>    │ Expect.equal
</span><span>    ╵
</span><span>    42
</span><span>
</span><span>    with debug logs:
</span><span>
</span><span>The question was: &quot;What is the Answer to the Ultimate Question of Life, The Universe, and Everything?&quot;
</span><span>
</span><span>
</span><span>TEST RUN FAILED
</span><span>
</span><span>Duration: 2 ms
</span><span>Passed:   0
</span><span>Failed:   1
</span></code></pre>
<p>There are other features that may interest you. See the <a href="https://github.com/mpizenberg/elm-test-rs#new-features-compared-to-elm-test">readme file</a>.</p>
<h2 id="performances">Performances</h2>
<p>Elm-test-rs is developed in a mix of Rust, Elm and JavaScript. The Rust part, which aims at generating the Elm code containing all your tests to run, usually takes only a few milliseconds. Most of the time is then spent either in the Elm compiler or in the Node process spawned to run the compiled tests. Since version 0.19.1-revision5, elm-test and elm-test-rs have the same strategy to gather your exposed tests. As such their performances are very similar. Comparing on a few well-known packages, I get the following execution times, averaged over 100 runs.</p>
<table><thead><tr><th><strong>test runner</strong></th><th><strong>empty app</strong></th><th><strong>list-extra (189 tests)</strong></th><th><strong>elm-color (8963 tests)</strong></th></tr></thead><tbody>
<tr><td>elm-test (rev 6)</td><td>0.56s</td><td><strong>0.74s</strong></td><td><strong>2.2 s</strong></td></tr>
<tr><td>elm-test-rs</td><td><strong>0.45s</strong></td><td>0.75s</td><td>2.7 s</td></tr>
</tbody></table>
<p>As you can see, both have very similar performances, with a slight advantage to elm-test for huge tests suites. This is mostly due to a design decision enabling the capture of <code>Debug.log</code> which increases the amount of messages between the Node supervisor and its runners. Another user <a href="https://discourse.elm-lang.org/t/gathering-feedback-on-elm-test-rs-before-1-0-release/6851/18">reported faster execution times with elm-test-rs</a> so I guess it eventually depends on the shape of your tests suite.</p>
<h2 id="breaking-changes">Breaking changes</h2>
<p>Elm-test and elm-test-rs have very similar outputs and behaviors for the most part. However, there are two changes that may break your tests:</p>
<ol>
<li>elm-test-rs does not automatically prepend a description with the module name to your tests;</li>
<li>elm-test-rs expects paths and globs leading to elm files, while elm-test also accepts directories.</li>
</ol>
<p>To fix (2) in your workflow, you can usually replace <code>path/to/dir</code> by <code>path/to/dir/**/*.elm</code> as arguments. To fix (1) for your tests, you can usually transform</p>
<pre data-lang="elm" style="background-color:#2b303b;color:#c0c5ce;" class="language-elm "><code class="language-elm" data-lang="elm"><span style="color:#d08770;">TestModule</span><span> exposing </span><span style="color:#b48ead;">(</span><span>a</span><span style="color:#96b5b4;">,</span><span> b</span><span style="color:#96b5b4;">,</span><span> c</span><span style="color:#b48ead;">)
</span></code></pre>
<p>into</p>
<pre data-lang="elm" style="background-color:#2b303b;color:#c0c5ce;" class="language-elm "><code class="language-elm" data-lang="elm"><span style="color:#d08770;">TestModule</span><span> exposing </span><span style="color:#b48ead;">(</span><span>tests</span><span style="color:#b48ead;">)
</span><span>
</span><span style="color:#8fa1b3;">tests </span><span>= describe &quot;</span><span style="color:#a3be8c;">TestModule</span><span>&quot; </span><span style="color:#96b5b4;">[</span><span> a</span><span style="color:#96b5b4;">,</span><span> b</span><span style="color:#96b5b4;">,</span><span> c </span><span style="color:#96b5b4;">]
</span></code></pre>
<p>The reasons for (1) are detailed in an <a href="https://github.com/rtfeldman/node-test-runner/issues/493">issue on GitHub</a>.</p>
<h2 id="code-architecture">Code architecture</h2>
<p>The code of elm-test-rs is designed with the objective of being</p>
<ul>
<li>as simple and lightweight as reasonably possible;</li>
<li>modular;</li>
<li>well documented.</li>
</ul>
<p>It is split in three parts, each of them being replaceable.</p>
<ol>
<li>The CLI, a Rust application that generates all the needed JS and Elm files to run tests.</li>
<li>The supervisor, a small Node JS script (roughly 100 lines, with no dependency other than Node itself) tasked to spawn runners (Elm), start a reporter (Elm) and transfer tests results from the runners to the reporter.</li>
<li>An Elm package (<code>mpizenberg/elm-test-runner</code>) exposing a main program for a runner and another one for a reporter.</li>
</ol>
<p><img src="elm-test-rs-flow.png" alt="Execution flow of elm-test-rs" /></p>
<h2 id="future-contributions-and-improvements">Future contributions and improvements</h2>
<p>I am very happy with what elm-test-rs turned out to be but there are still many improvements that could be made, such as better support of <code>Debug.log</code> in fuzz tests, improving performances of runners work distribution, a Deno or Browser supervisor, and many more. Don’t hesitate to have a look at the <a href="https://github.com/mpizenberg/elm-test-rs/issues">already existing issues</a> or to open new ones!</p>
<p>Personally, I am super happy that elm-test-rs will enable a better student experience for the incoming v3 of the <a href="https://exercism.io">exercism</a> learning platform. I hope you are also excited by this new release of elm-test-rs, bringing us one step closer to an ecosystem where we don’t need JavaScript to enjoy Elm!</p>
</div>

</div>
</div>
</div>
</section>


	</body>
</html>
